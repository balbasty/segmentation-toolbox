function y1 = affine_transf(M,phi)
y1 = cat(4,M(1,1)*phi(:,:,:,1) + M(1,2)*phi(:,:,:,2) + M(1,3)*phi(:,:,:,3) + M(1,4),...
           M(2,1)*phi(:,:,:,1) + M(2,2)*phi(:,:,:,2) + M(2,3)*phi(:,:,:,3) + M(2,4),...
           M(3,1)*phi(:,:,:,1) + M(3,2)*phi(:,:,:,2) + M(3,3)*phi(:,:,:,3) + M(3,4));
%==========================================================================